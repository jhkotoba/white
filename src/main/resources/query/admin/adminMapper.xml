<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="adminMapper">
	
	<select id="selectUserCount" resultType="int" parameterType="WhiteMap">
		SELECT COUNT(1) FROM white_user
		WHERE 1=1
		<if test="srhId != ''">
		AND user_id = #{srhId}
		</if>
		<if test="srhNm != ''">
		AND user_name = #{srhNm}
		</if>
	</select>
	
	<select id="selectUserList" resultType="WhiteMap" parameterType="WhiteMap">
		SELECT 
			user_seq AS userSeq,
			user_id AS userId,
			user_name AS userName
 		FROM white_user
 		WHERE 1=1
 		<if test="srhId != ''">
		AND user_id = #{srhId}
		</if>
		<if test="srhNm != ''">
		AND user_name = #{srhNm}
		</if>
 		Limit ${pagePre}, ${pageCnt}
	</select>
	
	<select id="selectAuthList" resultType="WhiteMap">
		SELECT 
			auth_nm_seq AS authNmSeq,
			auth_nm AS authNm
 		FROM auth_name
 		WHERE auth_nm <![CDATA[ <> ]]> 'developer'
	</select>
	
	<select id="selectUserAuth" resultType="WhiteMap" parameterType="WhiteMap">
		SELECT
			auth.auth_seq AS authSeq,
			auth.auth_nm_seq AS authNmSeq,
			name.auth_nm AS authNm
		FROM authority auth
		LEFT OUTER JOIN auth_name name
		ON name.auth_nm_seq = auth.auth_nm_seq
		WHERE auth.user_seq = #{userNo}
   		AND name.auth_nm <![CDATA[ <> ]]> 'developer'
	</select>
	
	
	<!--  -->
	<select id="selectNavMenuList" resultType="whiteMap" parameterType="whiteMap">		
		SELECT
			<if test="mode == 'select'">
			'select' AS state,
			</if>
			nm.nav_seq AS navSeq,
	  		nm.nav_nm AS navNm,
	 		nm.nav_url AS navUrl,
	 		nm.nav_order AS navOrder,
			nm.auth_nm_seq AS authNmSeq
			<if test="mode == 'menu'">
			,IF(
				(
					SELECT a.auth_seq FROM authority a
					WHERE a.auth_nm_seq = nm.auth_nm_seq
					AND a.user_seq = #{userSeq}
					LIMIT 1
				) IS NULL, 0, 1
			) AS auth
			</if>
		FROM nav_menu nm
		ORDER BY nm.nav_order
	</select>
	
	<!--  -->
	<select id="selectSideMenuList" resultType="whiteMap" parameterType="whiteMap">
		SELECT
			<if test="mode == 'select'">
			'select' AS state,
			</if>
			side_seq AS sideSeq,
			nav_seq AS navSeq,
			side_nm AS sideNm,
			side_url AS sideUrl,		
			side_order AS sideOrder		
		FROM side_menu
		ORDER BY side_order	
	</select>	
	
	
	<insert id="insertAuthList" parameterType="java.util.List">
		INSERT INTO authority(		
			user_seq,	
			auth_nm_seq
		)VALUES
		<foreach collection="list" item="item" separator="),(" open="(" close=")">
			#{item.userNo}, 
			#{item.authNmSeq}	
		</foreach>	
	</insert>
	
	<!-- 네비메뉴 insert -->
	<insert id="insertNavMenuList" parameterType="java.util.List">
		INSERT INTO nav_menu(		
			nav_nm,	
			nav_url,
			auth_nm_seq,
			nav_order
		)VALUES
		<foreach collection="list" item="item" separator="),(" open="(" close=")">
			#{item.navNm}, 
			#{item.navUrl},
			#{item.authNmSeq},
			#{item.navOrder}			
		</foreach>	
	</insert>
	
	
	<!-- 네비메뉴 수정 -->
	<update id="updateNavMenuList" parameterType="java.util.List">		
		UPDATE nav_menu
		SET nav_nm = 
		CASE		
		<foreach collection="list" item="item">
			WHEN nav_seq = #{item.navSeq} THEN #{item.navNm}
		</foreach>		
		END,	
		nav_url = 
		CASE		
		<foreach collection="list" item="item">
			WHEN nav_seq = #{item.navSeq} THEN #{item.navUrl}
		</foreach>		
		END,
		auth_nm_seq = 
		CASE		
		<foreach collection="list" item="item">
			WHEN nav_seq = #{item.navSeq} THEN #{item.authNmSeq}
		</foreach>		
		END,
		nav_order = 
		CASE		
		<foreach collection="list" item="item">
			WHEN nav_seq = #{item.navSeq} THEN #{item.navOrder}
		</foreach>		
		END
		WHERE nav_seq IN 
		<foreach collection="list" item="item" separator="," open="(" close=")">
			#{item.navSeq}
		</foreach>
	</update>
	
	
	<delete id="deleteAuthList" parameterType="java.util.List">
		DELETE FROM authority
		WHERE auth_seq IN 
		<foreach collection="list" item="item" separator="," open="(" close=")">
			#{item.authSeq}
		</foreach>
	</delete>
	
	<!-- 네비메뉴 삭제 -->
	<delete id="deleteNavMenuList" parameterType="java.util.List">
		DELETE FROM nav_menu
		WHERE nav_seq IN 
		<foreach collection="list" item="item" separator="," open="(" close=")">
			#{item.navSeq}
		</foreach>
	</delete>
	
</mapper>
